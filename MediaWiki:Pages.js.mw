/* On this page there is functionality for specific pages. This is seldomly needed */

(function() {
	
	// ==============
	// Page: Homepage
	
	if( $('body').hasClass('page-Homepage') ) {
		
		let scrollMargin = 70;
		let urlObj = new URL(window.location);
		let baseUrl = window.mwDev.data.app.baseUrl;
		
		// Section Competition
		
		$('.section-competition .show-more').on( 'click', function() {
			$(this).remove();
			$('.section-competition .show-for-nojs-only').removeClass('show-for-nojs-only');
		});
		
		// Section Features and Section Values
		
		if( urlObj.hash && urlObj.hash.match( /^#explain-/ ) ) {
			// Open extendable box containing card
			let collapseContainer = $( urlObj.hash ).parents('.mw-collapsed')
			if( collapseContainer.length ) collapseContainer.find('.mw-collapsible-toggle')[0].click();
			// Scroll to card and open Modal
			$('html, body').stop().animate( { 'scrollTop': $( urlObj.hash ).offset().top - scrollMargin }, 800, 'swing', () => $(window).miniModal('checkForModalsCalledByHash') );
		}
		
		$('.section-features, .section-values').find('.col-container .card-wrapper').each( function() {
			
			// Setup
			
			let id = $(this).attr('id');
			
			// Replace a-anchor with div (to make text selectable)
			let linkReplacement = $('<div></div>');
			linkReplacement.append( $(this).find( 'a > *' ) );
			$(this).children().replaceWith( linkReplacement );
			
			// Add share link to modal
			let shareButtonForModal = $( `<span class="code-select" data-button-image-src="/w/images/thumb/9/9f/Share-icon.png/40px-Share-icon.png">${baseUrl}#${id}</span>` );
			$( '#modal-' + id ).append( shareButtonForModal );
			shareButtonForModal.codeSelect('init');
			
			// Add attribute to modal to make it react to url hash
			$( '#modal-' + id ).attr( 'data-url-hash', id );
			
			// When there is a hash corresponding to a card, highlight that card
			if( $( urlObj.hash ).length ) $( urlObj.hash ).addClass( 'hash-target' );
			
			// Events
			
			// If there's no text selection, open modal and change url
			linkReplacement.on( 'click', function(e) {
				let sel = window.getSelection();
				if( sel && sel.type != 'None' && ! sel.isCollapsed ) return;
				$( '#modal-' + id ).miniModal('show');
			});
			
		});
		
		// Events
		
		// Click to start playing video

		$('.section-banner #hide-overview-image').on('click', () => {
			let handle = setInterval( () => {
				if( document.querySelector('.section-banner .overview-image-and-video-player video').readyState < 1 ) return;
				
				clearInterval( handle );
				$('.section-banner .overview-image-and-video-player video').css('display','block');
				$('.section-banner .overview-image-and-video-player video')[0].play()
			}, 500 );
		});
		
	}
	
})();