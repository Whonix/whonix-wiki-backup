{{Header}}
{{#seo:
|description=Information about {{project_name_gateway_long}} System DNS, /etc/resolv.conf and nslookup. Getting System DNS working on {{project_name_gateway_long}}.
|image=Robot-162087640.png
}}
[[image:Robot-162087640.png|200px|thumb]]
{{intro|
Information about {{project_name_gateway_long}} System DNS, /etc/resolv.conf and nslookup. Getting System DNS working on {{project_name_gateway_long}}.
}}
= Introduction =
{{Box|text=
System DNS here is defined as:

* resolving DNS,
** without use of a socksifier such as <code>torsocks</code>,
** without application proxy settings,
** without a Tor <code>SocksPort</code>.
* using the usual mechanisms on Linux for resolving DNS.
* that are usually configured through configuration file <code>/etc/resolv.conf</code>.
* that would happen when running <code>nslookup</code>.
}}

{{Box|text=
{{TorifiedGateway}}
}}

{{Box|text=
{{project_name_workstation_long}} is configured to use various [https://2019.www.torproject.org/docs/tor-manual.html.en#SocksPort <code>SocksPort</code>s], [https://2019.www.torproject.org/docs/tor-manual.html.en#DNSPort <code>DNSPort</code>] and [https://2019.www.torproject.org/docs/tor-manual.html.en#TransPort <code>TransPort</code>], see also [[Stream Isolation]]. Using system DNS on {{project_name_workstation_long}} by default does not require {{project_name_gateway_long}} system DNS. <ref>
That is because DNS traffic originating from {{project_name_workstation_long}} gets redirected to Tor's <code>DNSPort</code> running on {{project_name_gateway_long}} by [[Whonix-Gateway Firewall]].
</ref> Modifications of <code>/etc/resolv.conf</code> on {{project_name_gateway_long}} have no effect on {{project_name_workstation_long}}.
}}

{{Box|text=
{{project_name_gateway_long}} is only configured to use various <code>SocksPort</code>s. A global system DNS resolver to resolve DNS originating from applications running on {{project_name_gateway_long}} is not required for any common use case to justify enabling it by default. Use cases where this could be useful include:

* resolving the hostname of a proxy used in <code>/usr/local/etc/torrc.d/50_user.conf</code> through Tor would be useful ([https://sourceforge.net/projects/whonix/discussion/general/thread/41116dda/ technical explanation])
* resolving the hostname of a VPN. But then using a VPN configuration using IPs only would be better.
* Perhaps we could use <code>/etc/hosts</code> for such use cases rather than enabling system DNS?
}}

= Whonix-Gateway System DNS over Clearnet =
== Setup ==
'''Usually recommended against and unnecessary.'''

Clearnet Whonix-Gateway System DNS.

'''1.''' Make the following modifications to {{project_name_gateway_long}}.

{{Open with root rights
|filename=/etc/resolv.conf
}}

'''2.''' Uncomment <code>#nameserver 10.0.2.3</code>.

Remove the hash ("<code>#</code>") in front of <code>nameserver</code>. In other words, replace <code>#nameserver 10.0.2.3</code> with <code>nameserver 10.0.2.3</code>.

'''3.''' Platform specific steps.

* [[{{non_q_project_name_short}}|{{Non_q_project_name}}]]: Done.
* [[{{Q_project_name_short}}|{{Q_project_name}}]]: Replace <code>10.0.2.3</code>.
** To find out that IP to replace it with, run the following command.
** {{CodeSelect|code=
qubesdb-read /qubes-netvm-primary-dns
}}
** Should show for example:
** <blockquote>10.139.1.1</blockquote>
** Replace <code>10.0.2.3</code> with <code>10.139.1.1</code>. Note: Replace it with the actual IP, the output of above <code>qubesdb-read /qubes-netvm-primary-dns</code> command.

'''4.''' Done.

The {{project_name_gateway_short}} System DNS has been completed.

== Test ==
Using {{project_name_gateway_long}} user <code>clearnet</code>.

{{mbox
| type    = critical
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Using the <code>clearnet</code> user account, traffic will be sent over normal internet! Not over Tor! Will not be anonymous!
}}

Start <code>bash</code> under user <code>clearnet</code>.

<ref>
Similar to login as user <code>clearnet</code>.
</ref>

{{CodeSelect|code=
sudo -u clearnet bash
}}

Test it, for example using ping.

{{CodeSelect|code=
ping google.com
}}

= Whonix-Gateway System DNS over Tor =
'''Usually recommended against and unnecessary.'''

Torified Whonix-Gateway System DNS.

[[Undocumented]].

= Whonix-Gateway Default System DNS Setting =
At time of writing, none configured. Too verify, the following command all lines in the system DNS configuration file file <code>/etc/resolv.conf</code> except commented out files, those starting with a hash ("<code>#</code>").

{{CodeSelect|code=
cat /etc/resolv.conf {{!}} grep --invert-match \#
}}

Changing this might be safe, useful and required for [[Bridges]], pluggable transport, meek and easier [[Bridges#Snowflake|snowflake]] support:

https://forums.whonix.org/t/censorship-circumvention-tor-pluggable-transports/2601/40

= See Also =
* [[{{project_name_gateway_short}}_Own_Traffic_Transparent_Proxy|Enable Transparent Proxying for {{project_name_gateway_long}} own traffic]]

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]