{{Header}}
{{#seo:
|description=Redirect ports or unix domain socket files from {{project_name_gateway_long}} localhost to {{project_name_workstation_long}}.
|image=Redirect12123.png
}}
[[File:Redirect12123.png|thumb]]
{{intro|
Redirect ports or unix domain socket files from {{project_name_workstation_short}} localhost to {{project_name_gateway_short}}.
}}
= Introduction =
Port or unix domain socket file redirection could be useful for any future applications that expect Tor or the <code>ControlPort</code> to listen on any specific port or unix domain socket file that is not (yet) added to [[Dev/anon-ws-disable-stacked-tor|anon-ws-disable-stacked-tor]] [https://github.com/Whonix/anon-ws-disable-stacked-tor/blob/master/usr/libexec/anon-ws-disable-stacked-tor/systemd-unit-files-generator#L20 <u>b</u>uild-ins] or c[https://github.com/{{project_name_short}}/anon-ws-disable-stacked-tor/blob/master/etc/anon-ws-disable-stacked-tor.d/30_anon-dist.conf onfig] by default, or for any other port or unix domain socket file redirections from the workstation to the gateway.

= Instructions =
To create a port or unix domain socket file, it is required to create and extend config file <code>/etc/anon-ws-disable-stacked-tor.d/50_user.conf</code>. <ref>https://github.com/{{project_name_short}}/anon-ws-disable-stacked-tor/blob/master/etc/anon-ws-disable-stacked-tor.d/30_anon-dist.conf</ref>

'''1.''' Inside {{project_name_workstation_short}}.

'''2.''' Platform specific notice.

* {{non_q_project_name_long}}: No special notice.
* {{q_project_name_long}}: users should use folder <code>/etc/anon-ws-disable-stacked-tor.d</code> rather than folder <code>/usr/local/etc/anon-ws-disable-stacked-tor.d/</code> and apply this in <code>{{project_name_workstation_template}}</code> Template. <ref>
The missing Qubes-Whonix feature is that <code>/usr/libexec/anon-ws-disable-stacked-tor/systemd-unit-files-generator</code> doesn't run at boot time and that files generated by <code>/usr/libexec/anon-ws-disable-stacked-tor/systemd-unit-files-generator</code> don't persist after reboot of a TemplateBasedVM.
</ref>

'''3.''' Create folder <code>/usr/local/etc/anon-ws-disable-stacked-tor.d/</code>.

{{CodeSelect|code=
sudo mkdir -p /usr/local/etc/anon-ws-disable-stacked-tor.d
}}

'''4.''' {{Open with root rights|filename=
/usr/local/etc/anon-ws-disable-stacked-tor.d/50_user.conf
}}

'''5.''' Port redirection or unix domain socket file redirection.

'''A)''' Either add a port redirection.

For example to redirect {{project_name_workstation_short}} port <code>9100</code> to {{project_name_gateway_short}} port <code>9050</code>. Note: adjust the port numbers for your needs.

{{CodeSelect|code=
file_port_tuples+=" port#9100:9050 "
}}

'''B)''' Unix domain socket file redirection.

Create a unix domain socket file <code>/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock</code> and have it forwarded to {{project_name_gateway_short}} port <code>9050</code>.

{{CodeSelect|code=
file_port_tuples+=" /var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock#9050 "
}}

'''6.''' Save.

'''7.''' Run the <code>systemd-socket-proxyd</code> <code>systemd-unit-files-generator</code>. <ref>
https://github.com/Whonix/anon-ws-disable-stacked-tor/blob/master/usr/libexec/anon-ws-disable-stacked-tor/systemd-unit-files-generator
</ref>

{{CodeSelect|code=
sudo /usr/libexec/anon-ws-disable-stacked-tor/systemd-unit-files-generator
}}

'''8.''' Done.

The process of creating a redirection is now complete.

= Testing =
To test <code>/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock</code>, you could use:

{{CodeSelect|code=
socat - UNIX-CONNECT:/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock
}}

Then type:

{{CodeSelect|code=
GET
}}

Then press <code><enter></code>.

The expected reply includes <code>Tor is not an HTTP Proxy</code>.

= Footnotes =
{{reflist|close=1}}
[[Category:Documentation]]
{{Footer}}